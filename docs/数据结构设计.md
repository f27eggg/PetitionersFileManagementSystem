# 数据结构设计文档

## 概述

本文档详细描述上访人员档案管理系统的数据结构设计，包含所有字段的定义、数据类型、约束条件及说明。

## 数据模块划分

根据Excel模板分析，上访人员档案数据分为以下四大模块：

```
上访人档案
├── 个人信息（PersonalInfo）      - 17个字段
├── 在京关系人（BeijingContact）  - 6个字段
├── 信访案件（PetitionCase）      - 7个字段
└── 评估结果（RiskAssessment）    - 1个字段

总计：31个字段（包含动态列表字段）
```

---

## 一、个人信息模块（PersonalInfo）

### 1.1 基本身份信息

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 1 | 姓名 | name | 字符串 | 是 | 上访人员真实姓名 |
| 2 | 身份证号 | idCard | 字符串(18位) | 是 | 18位身份证号码，唯一标识 |
| 3 | 性别 | gender | 枚举 | 是 | 男/女 |
| 4 | 籍贯 | nativePlace | 字符串 | 否 | 民族/籍贯信息（如：汉族） |
| 5 | 学历 | education | 枚举 | 否 | 小学/初中/高中/中专/大专/本科/硕士/博士/其他 |
| 6 | 曾用名 | formerName | 字符串 | 否 | 历史使用过的姓名 |
| 7 | 婚姻状态 | maritalStatus | 枚举 | 否 | 未婚/已婚/离异/丧偶 |
| 8 | 配偶 | spouse | 字符串 | 否 | 配偶姓名 |

### 1.2 联系方式

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 9 | 联系方式 | phones | 字符串列表 | 是 | 联系电话列表，至少一个，可动态添加 |

**说明**：
- 联系方式采用列表结构，支持动态添加多个电话号码
- 第一个号码为主要联系方式，必填
- 后续号码为备用联系方式，可选
- 示例：`["13800138000", "010-12345678", "13900139000"]`

### 1.3 职业与住址

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 10 | 职业/收入来源 | occupation | 字符串 | 否 | 当前职业或主要收入来源 |
| 11 | 工作地址 | workAddress | 字符串 | 否 | 工作单位地址 |
| 12 | 常住地址 | homeAddress | 字符串 | 否 | 日常居住地址 |

### 1.4 上访相关信息

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 13 | 赴京上访次数 | visitCount | 整数 | 否 | 累计进京上访的次数 |
| 14 | 反侦察手段 | counterMeasures | 字符串 | 否 | 掌握的反侦察方法描述 |
| 15 | 消费住宿习惯 | consumptionHabits | 字符串 | 否 | 在京期间的消费和住宿习惯 |

### 1.5 个人照片

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 16 | 照片列表 | photos | 字符串列表 | 否 | 个人照片文件路径列表，支持多张照片 |

**说明**：
- 照片路径采用相对路径存储，便于项目移植
- 照片文件存储在 `data/photos/petitioners/{身份证号}/` 目录下
- 支持常见图片格式：jpg, jpeg, png, bmp
- 示例：`["photos/petitioners/110101199001011234/photo1.jpg", "photos/petitioners/110101199001011234/photo2.jpg"]`
- 第一张照片作为主照片，用于列表缩略图展示

---

## 二、在京关系人模块（BeijingContact）

记录上访人员在北京的社会关系人信息，用于追踪可能的协助网络。

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 1 | 姓名 | contactName | 字符串 | 否 | 在京关系人姓名 |
| 2 | 曾驻地 | formerAddress | 字符串 | 否 | 关系人曾经的居住地址 |
| 3 | 身份证号 | contactIdCard | 字符串(18位) | 否 | 关系人身份证号码 |
| 4 | 与信访人关系 | relationship | 字符串 | 否 | 与上访人的关系（亲属/朋友/同乡等） |
| 5 | 协助描述 | assistDescription | 长文本 | 否 | 提供的协助内容说明 |
| 6 | 照片列表 | photos | 字符串列表 | 否 | 关系人照片文件路径列表 |

**照片说明**：
- 关系人照片存储在 `data/photos/contacts/{关系人身份证号}/` 目录下
- 如无身份证号，使用 `{上访人身份证号}_contact_{序号}/` 作为目录名
- 示例：`["photos/contacts/110102199002022345/photo1.jpg"]`

---

## 三、信访案件模块（PetitionCase）

记录上访人员的诉求及上访行为相关信息。

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 1 | 诉求描述 | petitionContent | 长文本 | 否 | 上访的具体诉求内容 |
| 2 | 是否能解决 | canResolve | 枚举 | 否 | 是/否/部分可以 |
| 3 | 解决方式 | resolutionMethod | 字符串 | 否 | 预计或已采取的解决方式 |
| 4 | 信访人上访轨迹 | visitTrajectory | 长文本 | 否 | 历次上访的时间地点记录 |
| 5 | 进京方式 | entryMethod | 枚举 | 否 | 自驾车/火车/飞机/长途汽车/其他 |
| 6 | 在京通行方式 | transportInBeijing | 枚举 | 否 | 地铁/公交/出租车/网约车/步行/其他 |
| 7 | 有无接应人 | hasReception | 枚举 | 否 | 有/无/不详 |

---

## 四、评估结果模块（RiskAssessment）

对上访人员的综合风险评估结果。

| 序号 | 字段名 | 字段标识 | 数据类型 | 是否必填 | 说明 |
|------|--------|----------|----------|----------|------|
| 1 | 危险等级 | riskLevel | 枚举 | 否 | 低危/中危/高危/极高危 |

---

## 五、数据关系说明

### 5.1 主键设计

- **唯一标识**：以"身份证号"（idCard）作为上访人员的唯一标识
- **数据ID**：系统内部生成UUID作为记录的技术主键

### 5.2 一对多关系

- 一个上访人可对应多条上访记录（未来扩展）
- 一个上访人可对应多个在京关系人（当前版本简化为单条记录）
- 一个上访人可对应多张照片
- 一个关系人可对应多张照片

### 5.3 枚举值定义

#### 性别（Gender）
```
男、女
```

#### 学历（Education）
```
小学、初中、高中、中专、大专、本科、硕士、博士、其他
```

#### 婚姻状态（MaritalStatus）
```
未婚、已婚、离异、丧偶
```

#### 进京方式（EntryMethod）
```
自驾车、火车、高铁、飞机、长途汽车、其他
```

#### 在京通行方式（TransportMethod）
```
地铁、公交、出租车、网约车、步行、自驾、其他
```

#### 危险等级（RiskLevel）
```
低危、中危、高危、极高危
```

---

## 六、数据存储格式（JSON示例）

```json
{
  "id": "uuid-1234-5678-abcd",
  "createTime": "2025-11-22T10:30:00",
  "updateTime": "2025-11-22T10:30:00",
  "personalInfo": {
    "name": "张三",
    "idCard": "110101199001011234",
    "gender": "男",
    "nativePlace": "汉族",
    "education": "本科",
    "phones": [
      "13800138000",
      "010-12345678"
    ],
    "maritalStatus": "未婚",
    "formerName": "",
    "occupation": "无业",
    "workAddress": "",
    "spouse": "",
    "visitCount": 3,
    "counterMeasures": "频繁更换手机号码",
    "consumptionHabits": "经济型酒店",
    "homeAddress": "北京市海淀区xxx",
    "photos": [
      "photos/petitioners/110101199001011234/photo1.jpg",
      "photos/petitioners/110101199001011234/photo2.jpg"
    ]
  },
  "beijingContact": {
    "contactName": "李四",
    "formerAddress": "北京市朝阳区xxx",
    "contactIdCard": "110102199002022345",
    "relationship": "朋友",
    "assistDescription": "提供住宿",
    "photos": [
      "photos/contacts/110102199002022345/photo1.jpg"
    ]
  },
  "petitionCase": {
    "petitionContent": "土地纠纷问题",
    "canResolve": "否",
    "resolutionMethod": "",
    "visitTrajectory": "2025-01-15 北京市信访局\n2025-03-20 国家信访局",
    "entryMethod": "自驾车",
    "transportInBeijing": "地铁",
    "hasReception": "有"
  },
  "riskAssessment": {
    "riskLevel": "中危"
  }
}
```

---

## 七、照片文件存储结构

### 7.1 目录结构

```
data/
└── photos/
    ├── petitioners/              # 上访人员照片目录
    │   ├── 110101199001011234/   # 按身份证号分组
    │   │   ├── photo1.jpg        # 主照片
    │   │   ├── photo2.jpg        # 副照片
    │   │   └── photo3.png
    │   └── 110101199001015678/
    │       └── photo1.jpg
    └── contacts/                 # 关系人照片目录
        ├── 110102199002022345/
        │   └── photo1.jpg
        └── 110101199001011234_contact_1/  # 无身份证号时使用
            └── photo1.jpg
```

### 7.2 照片存储规则

1. **相对路径存储**：所有照片路径使用相对于项目根目录的路径
2. **目录命名**：
   - 有身份证号：使用身份证号作为目录名
   - 无身份证号：使用 `{上访人身份证号}_contact_{序号}` 格式
3. **文件命名**：
   - 建议格式：`photo{序号}.{扩展名}`
   - 支持格式：jpg, jpeg, png, bmp
4. **移植性保证**：
   - 整个 `data/` 目录可随程序一起复制
   - 程序启动时自动检测并使用相对路径
   - 避免使用绝对路径（如 `C:\xxx\`）

### 7.3 照片管理功能

- **上传**：支持批量上传，自动生成缩略图
- **删除**：删除照片记录时同步删除文件
- **预览**：支持照片放大查看、轮播
- **导出**：导出数据时可选择是否包含照片文件

---

## 八、字段验证规则

| 字段 | 验证规则 |
|------|----------|
| 身份证号 | 18位，符合身份证校验规则（包括校验码） |
| 联系方式 | 11位手机号或固话格式（010-12345678） |
| 赴京上访次数 | 非负整数 |
| 照片路径 | 文件必须存在，路径为相对路径 |
| 照片格式 | jpg/jpeg/png/bmp |
| 照片大小 | 单张不超过5MB |

---

## 九、数据变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0 | 2025-11-22 | 初始版本 |
| v1.1 | 2025-11-22 | 调整数据结构：<br>1. 联系方式由3个固定字段改为动态列表<br>2. 删除字段：是否懂技侦手段、描述、统计分值<br>3. 重命名字段：具体反侦察手段→反侦察手段<br>4. 新增字段：个人照片列表、关系人照片列表<br>5. 字段总数：33→31个 |

---

*文档版本：v1.1*
*创建日期：2025年11月22日*
*最后更新：2025年11月22日*
